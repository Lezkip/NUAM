{% extends "base.html" %}
{% block title %}Listado de Emisores{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3">Emisores Registrados</h1>
  {% if user.is_superuser or user.is_staff %}
    <a href="{% url 'emisor_create' %}" class="btn btn-primary">Nuevo Emisor</a>
  {% endif %}
</div>

{% if emisores %}
  <div class="mb-3">
    <input type="text" id="searchTable" class="form-control" placeholder="üîç Buscar por RUT, nombre, direcci√≥n o estado...">
  </div>
  <div class="table-responsive">
    <table class="table table-striped table-hover" id="dataTable">
      <thead class="table-dark">
        <tr>
          <th>RUT</th>
          <th>Nombre</th>
          <th>Direcci√≥n</th>
          <th>Estado</th>
          {% if user.is_superuser or user.is_staff %}<th>Acciones</th>{% endif %}
        </tr>
      </thead>
      <tbody>
        {% for e in emisores %}
          <tr>
            <td><strong>{{ e.rut }}</strong></td>
            <td>{{ e.nombre }}</td>
            <td>{{ e.direccion|default:"Sin direcci√≥n" }}</td>
            <td>
              {% if e.activo %}
                <span class="badge bg-success">Activo</span>
              {% else %}
                <span class="badge bg-danger">Inactivo</span>
              {% endif %}
            </td>
            {% if user.is_superuser or user.is_staff %}
            <td>
              <a href="{% url 'emisor_update' e.id %}" class="btn btn-sm btn-warning">Editar</a>
              <a href="{% url 'emisor_delete' e.id %}" class="btn btn-sm btn-danger">Eliminar</a>
            </td>
            {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-info">No hay emisores registrados.</div>
{% endif %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchTable');
    const table = document.getElementById('dataTable');
    if (searchInput && table) {
      const rows = table.querySelectorAll('tbody tr');
      searchInput.addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        rows.forEach(row => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(filter) ? '' : 'none';
        });
      });
    }
  });
</script>
{% endblock %}

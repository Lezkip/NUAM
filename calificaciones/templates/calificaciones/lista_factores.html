{% extends "base.html" %}
{% block title %}Listado de Factores Tributarios{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3">Factores Tributarios</h1>
  {% if user.is_superuser or user.is_staff %}
    <a href="{% url 'factor_create' %}" class="btn btn-primary">Nuevo Factor</a>
  {% endif %}
</div>

{% if factores %}
  <div class="mb-3">
    <input type="text" id="searchTable" class="form-control" placeholder=" Buscar por c贸digo, descripci贸n o estado...">
  </div>
  <div class="table-responsive">
    <table class="table table-striped table-hover" id="dataTable">
      <thead class="table-dark">
        <tr>
          <th>C贸digo</th>
          <th>Descripci贸n</th>
          <th>Estado</th>
          {% if user.is_superuser or user.is_staff %}<th>Acciones</th>{% endif %}
        </tr>
      </thead>
      <tbody>
        {% for f in factores %}
          <tr>
            <td><strong>{{ f.codigo }}</strong></td>
            <td>{{ f.descripcion }}</td>
            <td>
              {% if f.vigente %}
                <span class="badge bg-success">Vigente</span>
              {% else %}
                <span class="badge bg-warning">No Vigente</span>
              {% endif %}
            </td>
            {% if user.is_superuser or user.is_staff %}
            <td>
              <a href="{% url 'factor_update' f.id %}" class="btn btn-sm btn-warning">Editar</a>
              <a href="{% url 'factor_delete' f.id %}" class="btn btn-sm btn-danger">Eliminar</a>
            </td>
            {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-info">No hay factores registrados.</div>
{% endif %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchTable');
    const table = document.getElementById('dataTable');
    if (searchInput && table) {
      const rows = table.querySelectorAll('tbody tr');
      searchInput.addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        rows.forEach(row => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(filter) ? '' : 'none';
        });
      });
    }
  });
</script>
{% endblock %}
